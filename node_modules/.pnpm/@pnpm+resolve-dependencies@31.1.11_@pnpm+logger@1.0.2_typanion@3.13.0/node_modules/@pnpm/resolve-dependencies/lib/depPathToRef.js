"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.depPathToRef = void 0;
const dependency_path_1 = require("@pnpm/dependency-path");
const encode_registry_1 = __importDefault(require("encode-registry"));
function depPathToRef(depPath, opts) {
    if (opts.resolution.type)
        return depPath;
    const registryName = (0, encode_registry_1.default)((0, dependency_path_1.getRegistryByPackageName)(opts.registries, opts.realName));
    if (depPath.startsWith(`${registryName}/`)) {
        depPath = depPath.replace(`${registryName}/`, '/');
    }
    if (depPath[0] === '/' && opts.alias === opts.realName) {
        const ref = depPath.replace(`/${opts.realName}/`, '');
        if (!ref.includes('/') || !ref.replace(/(\([^)]+\))+$/, '').includes('/'))
            return ref;
    }
    return depPath;
}
exports.depPathToRef = depPathToRef;
//# sourceMappingURL=depPathToRef.js.map