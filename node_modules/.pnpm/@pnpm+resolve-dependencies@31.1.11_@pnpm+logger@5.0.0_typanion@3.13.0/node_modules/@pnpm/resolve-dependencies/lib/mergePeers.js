"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.safeIntersect = exports.mergePeers = void 0;
const semver_range_intersect_1 = require("semver-range-intersect");
function mergePeers(missingPeers) {
    const conflicts = [];
    const intersections = {};
    for (const [peerName, ranges] of Object.entries(missingPeers)) {
        if (ranges.every(({ optional }) => optional))
            continue;
        if (ranges.length === 1) {
            intersections[peerName] = ranges[0].wantedRange;
            continue;
        }
        const intersection = safeIntersect(ranges.map(({ wantedRange }) => wantedRange));
        if (intersection === null) {
            conflicts.push(peerName);
        }
        else {
            intersections[peerName] = intersection;
        }
    }
    return { conflicts, intersections };
}
exports.mergePeers = mergePeers;
function safeIntersect(ranges) {
    try {
        return (0, semver_range_intersect_1.intersect)(...ranges);
    }
    catch {
        return null;
    }
}
exports.safeIntersect = safeIntersect;
//# sourceMappingURL=mergePeers.js.map