"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.applyPatchToDir = void 0;
const error_1 = require("@pnpm/error");
const applyPatches_1 = require("@pnpm/patch-package/dist/applyPatches");
function applyPatchToDir(opts) {
    // Ideally, we would just run "patch" or "git apply".
    // However, "patch" is not available on Windows and "git apply" is hard to execute on a subdirectory of an existing repository
    const cwd = process.cwd();
    process.chdir(opts.patchedDir);
    let success = false;
    try {
        success = (0, applyPatches_1.applyPatch)({
            patchFilePath: opts.patchFilePath,
        });
    }
    catch (err) { // eslint-disable-line
        if (err.code === 'ENOENT') {
            throw new error_1.PnpmError('PATCH_NOT_FOUND', `Patch file not found: ${opts.patchFilePath}`);
        }
        throw new error_1.PnpmError('INVALID_PATCH', `Applying patch "${opts.patchFilePath}" failed: ${err.message}`);
    }
    finally {
        process.chdir(cwd);
    }
    if (!success) {
        throw new error_1.PnpmError('PATCH_FAILED', `Could not apply patch ${opts.patchFilePath} to ${opts.patchedDir}`);
    }
}
exports.applyPatchToDir = applyPatchToDir;
//# sourceMappingURL=index.js.map